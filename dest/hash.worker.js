!function(e){function r(o){if(t[o])return t[o].exports;var n=t[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var t={};return r.m=e,r.c=t,r.p="dest",r(0)}([function(e,r,t){"use strict";importScripts("https://d3js.org/d3.v3.min.js"),Array.prototype.findIndex||(Array.prototype.findIndex=function(e){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r,t=Object(this),o=t.length>>>0,n=arguments[1],a=0;a<o;a++)if(r=t[a],e.call(n,r,a,t))return a;return-1});var o=t(1),n=t(2).sortNumeric,a=t(3),i=t(4);onmessage=function(e){console.log("Message received from main script");var r=[],t=[];d3.csv("https://storage.googleapis.com/co-publicdata/grants.csv",function(e){d3.csv("../data/keypts.csv",function(s){s.forEach(function(e){r.indexOf(e.govname)===-1&&(r.push(e.govname),t.push([parseFloat(e.longitude),parseFloat(e.latitude)]),r.push(e.lgid),t.push([parseFloat(e.longitude),parseFloat(e.latitude)])),"EIAF"===e.program&&e.projectnmbr>0&&r.indexOf("#"+e.projectnmbr)===-1&&(r.push("#"+e.projectnmbr),t.push([parseFloat(e.longitude),parseFloat(e.latitude)])),"EIAF"===e.program&&e.projectnmbr>0&&r.indexOf("#"+e.projectnmbr)===-1&&(r.push("#"+e.projectnmbr),t.push([parseFloat(e.longitude),parseFloat(e.latitude)]))});var u=e.map(function(e){return a(e,s)}),p=u.filter(function(e){return!!e}),l=i(p);l.forEach(function(e){return o(e)}),l=l.sort(n),console.log("Posting message back to main script"),postMessage([l,r,t]),close()})})}},function(e,r){"use strict";var t=[];e.exports=function(e){function r(e){var r=(e-o)/864e5;return r}var o=new Date(2e3,0,1);t.indexOf(e.lgid)===-1&&t.push(e.lgid);var n=t.indexOf(e.lgid),a=1e8*n,i=e.program;"DR"===i&&(a+=1e5),"FML"===i&&(a+=12e5),"CTF"===i&&(a+=11e5),"SEV_FML"===i&&(a+=1e6),"CSBG"===i&&(a+=6e5),"CDBG"!==i&&"CDBGED"!==i&&"CDBGPF"!==i&&"CDBGPS"!==i||(a+=5e5),"EIAF"===i&&(a+=2e5),"GAME"===i&&(a+=3e5),"REDI"===i&&(a+=4e5),"MJ"!==i&&"GBMJ"!==i||(a+=13e5),"VFP"===i&&(a+=8e5),"SAR"!==i&&"SAR Tier 1"!==i&&"SAR Tier 3"!==i&&"SAR Tier 2"!==i&&"SAR EoY"!==i&&"BSARFX"!==i||(a+=7e5),"FCB"===i&&(a+=9e5),"CVRF"===i&&(a+=14e5),"SBR"===i&&(a+=14e5),"MSOB"===i&&(a+=14e5),"NEU"===i&&(a+=14e5),"IHOP"===i&&(a+=14e5),"IHOI"===i&&(a+=14e5),"HPLN"===i&&(a+=14e5),"PSI"===i&&(a+=14e5),"LOMA"===i&&(a+=14e5),"LPC"===i&&(a+=14e5),"LECS"===i&&(a+=14e5),"BBFS"===i&&(a+=14e5),"CENS"===i&&(a+=14e5),"MC"===i&&(a+=14e5),"MRP"===i&&(a+=14e5),"NPI"===i&&(a+=14e5),"RNSS"===i&&(a+=14e5),"SCIG"===i&&(a+=14e5);var s=Math.random();return a=a+r(e.dateofaward)+s,e.id=a,e}},function(e,r){"use strict";e.exports.sortNumeric=function(e,r){return e.id<r.id?1:-1},e.exports.monthNumStr=function(e){return"JAN"===e?0:"FEB"===e?1:"MAR"===e?2:"APR"===e?3:"MAY"===e?4:"JUN"===e?5:"JUL"===e?6:"AUG"===e?7:"SEP"===e?8:"OCT"===e?9:"NOV"===e?10:"DEC"===e?11:(console.log(e),console.log("unexpected fall through on monthNumStr"),99)}},function(e,r,t){"use strict";var o=t(2).monthNumStr;e.exports=function(e,r){function t(r,t,o){if(o[t].lgid===e.lgid)return!0}"FML_SB106"===e.program&&(e.program="FML");var n=e.dateofaward.split("-"),a=new Date(Number("20"+n[2]),o(n[1]),Number(n[0]));"null"===e.projectnmbr&&(e.projectnmbr=""),"null"===e.projname&&(e.projname=e.program+" Distribution");var i=r.findIndex(t);if(i>-1){var s={};return s.award=parseFloat(e.award),s.dateofaward=a,s.govname=r[i].govname,s.latitude=parseFloat(r[i].latitude),s.longitude=parseFloat(r[i].longitude),s.lgid=e.lgid,s.lgtype=parseInt(r[i].lgtype,10),s.program=e.program,s.projectnmbr=e.projectnmbr,s.projname=e.projname,s}console.log("problem? no match for "+e.lgid),console.log("please add an entry in the keypts.csv file for "+e.lgid)}},function(e,r){"use strict";e.exports=function(e){var r=[],t=e.map(function(e){var t=e.lgid;r.hasOwnProperty(t)?r[t]++:r[t]=0;var o=e.latitude+.002*r[t],n=e.longitude;return e.latLng=[o,n],e});return t}}]);