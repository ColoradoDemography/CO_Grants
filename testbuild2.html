<!DOCTYPE html>
<html>
<head>
    <title>L.D3SvgOverlay: Leaflet + D3, simple example</title>

    <style type="text/css">
        html { height: 100% }
        body { height: 100%; margin: 0; padding: 0 }
        #map-canvas { height: 100% }
    </style>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css'
    	rel='stylesheet' type='text/css'/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">

</head>
<body>
  <div id="map-canvas"></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.9/d3.min.js"></script>
<script src="js/L.D3SvgOverlay.min.js"></script>
<script>

var map = L.map("map-canvas",{center:[40, -105],zoom:8});
L.tileLayer('http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpeg', {
	attribution: 'Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a> '
	+'&mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
	subdomains: '1234'
}).addTo(map);

var cities = [];
var citiesOverlay = L.d3SvgOverlay(function(sel,proj){
	

  var citiesUpd = sel.selectAll('circle').data(cities);
  citiesUpd.enter()
    .append('circle')
    .attr('r',function(d){return 2;})
    .attr('cx',function(d){return proj.latLngToLayerPoint(d.latLng).x;})
    .attr('cy',function(d){return proj.latLngToLayerPoint(d.latLng).y;})
    .attr('stroke','black')
    .attr('stroke-width',0.1)
    .attr('fill',function(d){return "red";});
});
  
  var stackchips=[];

d3.csv("../CO_Grants_Data/grantpts.csv",function(data){
  cities = data.map(function(d){
    
                        var tv = d.lgid;
    
                    if (stackchips.hasOwnProperty(tv)) {
                        stackchips[tv]++;
                    } else {
                        stackchips[tv] = 0;
                    }

    
                    var rlat = (parseFloat(d.latitude) + (.003 * stackchips[tv]));
    console.log(d.latitude);
    console.log(rlat);
                    var rlng = d.longitude;

                    d.latLng = [rlat,rlng];
    
    return d;
    
    
  });
  citiesOverlay.addTo(map);
});


</script>
    
</body>
</html>